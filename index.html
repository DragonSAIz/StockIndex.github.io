<!DOCTYPE html>
<html>
<head>
    <title>数据可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <style>
        /* 强制全屏遮罩层（网页1方案增强） */
        #disclaimer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;  /* 覆盖整个视口 */
            height: 100vh;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;  /* 确保置于最顶层 */
        }
        /* 弹窗内容容器 */
        .disclaimer-box {
            background: white;
            padding: 2rem;
            max-width: 800px;
            max-height: 80vh;  /* 移动端适配 */
            overflow-y: auto; /* 内容过长时滚动 */
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }
        
        /* 禁止背景滚动（网页1未提及的关键点） */
        body.disclaimer-active {
            overflow: hidden;
        }
        .controls { margin: 20px; padding: 10px; background: #f5f5f5; }
        .controls select, .controls button { margin-right: 15px; padding: 5px; }
        #chart { width: 95%; height: 666px; margin: 20px auto; }
    </style>
</head>
<body>
    <div class="controls">
        <!-- Sheet 选择 -->
        <select id="sheetSelect" onchange="loadSheetData()">
            <option value="Sheet1">H30269.csi 红利低波</option>
            <option value="Sheet2">000015.sh 红利指数</option>
            <option value="Sheet3">931446.csi 东证红利低波</option>
            <option value="Sheet4">000922.sh 中证红利</option>
        </select>

        <!-- 时间范围选择 -->
        <button onclick="filterData(30)">近1个月</button>
        <button onclick="filterData(90)">近3个月</button>
        <button onclick="filterData(180)">近半年</button>
        <button onclick="filterData(365)">近1年</button>
        <button onclick="filterData(1095)">近3年</button>
        <button onclick="filterData(1825)">近5年</button>
    </div>
    
    <div id="chart"></div>

    <script>
        let currentChart = null;
        let allData = []; // 存储原始数据
        let currentSheet = '';

        // 加载 Sheet 数据
        function loadSheetData() {
            currentSheet = document.getElementById('sheetSelect').value;
            fetch(`data_${currentSheet}.json`)
                .then(response => response.json())
                .then(data => {
                    allData = data;
                    renderChart(data); // 首次加载全量数据
                });
        }

        // 时间过滤函数
        function filterData(days) {
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - days);
            
            const filtered = allData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate > cutoffDate;
            });
            
            renderChart(filtered);
        }

        // 图表渲染核心函数
        function renderChart(data) {
            if (currentChart) currentChart.dispose();
            
            const chartDom = document.getElementById('chart');
            currentChart = echarts.init(chartDom);
            
            // 处理 r_cp 与其他系列
            const series = [];
            Object.keys(data[0]).forEach(key => {
                if (key === 'date') return;
                
                series.push({
                    name: key,
                    type: 'line',
                    showSymbol: false,
                    lineStyle: key === 'r_cp' ? { width: 3 } : { width: 1 },
                    data: data.map(d => d[key])
                });
            });

            const option = {
                title: { text: `${currentSheet} - 数据趋势` },
                tooltip: { trigger: 'axis' },
                legend: {
                    data: series.map(s => s.name),
                    selected: {
                        'r_cp': true // 强制显示 r_cp
                    }
                },
                xAxis: {
                    type: 'category',
                    data: data.map(d => d.date),
                    axisLabel: { rotate: 45 }
                },
                yAxis: { type: 'value' },
                series: series,
                dataZoom: [{
                    type: 'inside',
                    start: 0,
                    end: 100
                }]
            };

            currentChart.setOption(option);
        }

        // 默认加载第一个 Sheet
        loadSheetData();
    </script>

    <!-- 强制弹窗结构 -->
    <div id="disclaimer-overlay">
        <div class="disclaimer-box">
            <h2>免责声明</h2>
            <p>（此处填写详细声明内容）...</p>
            <button id="close-disclaimer">我已阅读并同意</button>
        </div>
    </div>

    <script>
        // 页面加载后强制显示（网页1事件绑定升级）
        window.addEventListener('DOMContentLoaded', () => {
            document.body.classList.add('disclaimer-active');
            
            // 禁止通过ESC关闭（增强强制特性）
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') e.preventDefault();
            });
        });

        // 关闭按钮事件（网页1基础逻辑）
        document.getElementById('close-disclaimer').addEventListener('click', () => {
            document.getElementById('disclaimer-overlay').remove();
            document.body.classList.remove('disclaimer-active');
            
            // 可选：存储同意状态（需补充localStorage逻辑）
        });
    </script>
</body>
<footer class="site-footer">
    <p>当你一旦使用本网站或其任何网页，即表示你无条件接受上述所载的<a href="disclaimer.html" target="_blank">免责声明</a></p>
</footer>
</html>
